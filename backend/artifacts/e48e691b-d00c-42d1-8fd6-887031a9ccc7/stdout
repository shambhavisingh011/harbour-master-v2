
PLAY [Phase 0 - Infrastructure Handshake Preparation] **************************

TASK [Ensure LVS files directory exists] ***************************************
[0;32mok: [localhost][0m

TASK [Generate SSH keypair for LVS Health Checks] ******************************
[0;32mok: [localhost][0m

PLAY [Phase 1 - Prepare All Nodes] *********************************************

TASK [Gathering Facts] *********************************************************
[1;35m[WARNING]: Host 'db-node-01' is using the discovered Python interpreter at '/usr/bin/python3.12', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.20/reference_appendices/interpreter_discovery.html for more information.[0m
[0;32mok: [db-node-01][0m
[1;35m[WARNING]: Host 'async-node' is using the discovered Python interpreter at '/usr/bin/python3.12', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.20/reference_appendices/interpreter_discovery.html for more information.[0m
[0;32mok: [async-node][0m

TASK [Wait for apt lock to be released] ****************************************
[0;33mchanged: [async-node][0m
[0;33mchanged: [db-node-01][0m

TASK [Install basic utilities] *************************************************
[0;32mok: [async-node][0m
[0;32mok: [db-node-01][0m

PLAY [Phase 1 - Prepare All Nodes] *********************************************

TASK [Gathering Facts] *********************************************************
[1;35m[WARNING]: Host 'db-node-02' is using the discovered Python interpreter at '/usr/bin/python3.12', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.20/reference_appendices/interpreter_discovery.html for more information.[0m
[0;32mok: [db-node-02][0m
[1;35m[WARNING]: Host 'db-node-03' is using the discovered Python interpreter at '/usr/bin/python3.12', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.20/reference_appendices/interpreter_discovery.html for more information.[0m
[0;32mok: [db-node-03][0m

TASK [Wait for apt lock to be released] ****************************************
[0;33mchanged: [db-node-02][0m
[0;33mchanged: [db-node-03][0m

TASK [Install basic utilities] *************************************************
[0;32mok: [db-node-02][0m
[0;32mok: [db-node-03][0m

PLAY [Phase 1 - Prepare All Nodes] *********************************************

TASK [Gathering Facts] *********************************************************
[1;35m[WARNING]: Host 'lvs-node-1' is using the discovered Python interpreter at '/usr/bin/python3.12', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.20/reference_appendices/interpreter_discovery.html for more information.[0m
[0;32mok: [lvs-node-1][0m
[1;35m[WARNING]: Host 'lvs-node-2' is using the discovered Python interpreter at '/usr/bin/python3.12', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.20/reference_appendices/interpreter_discovery.html for more information.[0m
[0;32mok: [lvs-node-2][0m

TASK [Wait for apt lock to be released] ****************************************
[0;33mchanged: [lvs-node-1][0m
[0;33mchanged: [lvs-node-2][0m

TASK [Install basic utilities] *************************************************
[0;32mok: [lvs-node-2][0m
[0;32mok: [lvs-node-1][0m

PLAY [Phase 1 - Prepare All Nodes] *********************************************

TASK [Gathering Facts] *********************************************************
[1;35m[WARNING]: Host 'monitor-node' is using the discovered Python interpreter at '/usr/bin/python3.12', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.20/reference_appendices/interpreter_discovery.html for more information.[0m
[0;32mok: [monitor-node][0m

TASK [Wait for apt lock to be released] ****************************************
[0;33mchanged: [monitor-node][0m

TASK [Install basic utilities] *************************************************
[0;32mok: [monitor-node][0m

PLAY [Phase 2 - Setup MariaDB Repositories] ************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [db-node-02][0m
[0;32mok: [db-node-01][0m

TASK [common : Check if MariaDB is already installed] **************************
[0;32mok: [db-node-01][0m
[0;32mok: [db-node-02][0m

TASK [common : Extract installed version string] *******************************
[0;32mok: [db-node-01][0m
[0;32mok: [db-node-02][0m

TASK [common : Block execution if versions mismatch] ***************************
[0;36mskipping: [db-node-01][0m
[0;36mskipping: [db-node-02][0m

TASK [common : Update apt cache] ***********************************************
[0;32mok: [db-node-01][0m
[0;32mok: [db-node-02][0m

TASK [common : Install dependencies] *******************************************
[0;32mok: [db-node-01][0m
[0;32mok: [db-node-02][0m

TASK [common : Add MariaDB GPG key] ********************************************
[0;32mok: [db-node-02][0m
[0;32mok: [db-node-01][0m

TASK [common : Add MariaDB Repository for version 10.11] ***********************
[1;35m[WARNING]: Deprecation warnings can be disabled by setting `deprecation_warnings=False` in ansible.cfg.[0m
[0;35m[0m
[0;32mok: [db-node-02][0m
[0;32mok: [db-node-01][0m

TASK [common : Update apt cache after adding repo] *****************************
[0;36mskipping: [db-node-01][0m
[0;36mskipping: [db-node-02][0m

PLAY [Phase 2 - Setup MariaDB Repositories] ************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [db-node-03][0m
[0;32mok: [async-node][0m

TASK [common : Check if MariaDB is already installed] **************************
[0;32mok: [db-node-03][0m
[0;32mok: [async-node][0m

TASK [common : Extract installed version string] *******************************
[0;32mok: [db-node-03][0m
[0;32mok: [async-node][0m

TASK [common : Block execution if versions mismatch] ***************************
[0;36mskipping: [db-node-03][0m
[0;36mskipping: [async-node][0m

TASK [common : Update apt cache] ***********************************************
[0;32mok: [db-node-03][0m
[0;32mok: [async-node][0m

TASK [common : Install dependencies] *******************************************
[0;32mok: [async-node][0m
[0;32mok: [db-node-03][0m

TASK [common : Add MariaDB GPG key] ********************************************
[0;32mok: [db-node-03][0m
[0;32mok: [async-node][0m

TASK [common : Add MariaDB Repository for version 10.11] ***********************
[0;32mok: [db-node-03][0m
[0;32mok: [async-node][0m

TASK [common : Update apt cache after adding repo] *****************************
[0;36mskipping: [db-node-03][0m
[0;36mskipping: [async-node][0m

PLAY [Phase 3 - Build Galera Cluster] ******************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [db-node-01][0m

TASK [galera : DISCOVERY: Audit all nodes (Pre-Flight)] ************************
[0;32mok: [db-node-01] => (item=db-node-01)[0m
[0;32mok: [db-node-01 -> db-node-02(192.168.64.3)] => (item=db-node-02)[0m
[0;32mok: [db-node-01 -> db-node-03(192.168.64.4)] => (item=db-node-03)[0m

TASK [galera : DISCOVERY: Check if MariaDB is installed] ***********************
[0;32mok: [db-node-01][0m

TASK [galera : DISCOVERY: Check local service status] **************************
[0;32mok: [db-node-01][0m

TASK [galera : DISCOVERY: Check local Galera state] ****************************
[0;32mok: [db-node-01][0m

TASK [galera : DISCOVERY: Get Sequence Number (GTID) from grastate] ************
[0;32mok: [db-node-01][0m

TASK [galera : DISCOVERY: Check HCIP ownership] ********************************
[0;32mok: [db-node-01][0m

TASK [galera : LOGIC: Set Local Discovery Facts] *******************************
[0;32mok: [db-node-01][0m

TASK [galera : LOGIC: Determine best Bootstrap node (Last Man Standing)] *******
[0;32mok: [db-node-01][0m

TASK [galera : INSTALL: Base MariaDB & Dependencies] ***************************
[0;36mskipping: [db-node-01][0m

TASK [galera : CASE 4: Resolve Split-Brain via HCIP Master] ********************
[0;36mskipping: [db-node-01][0m

TASK [galera : Prepare grastate.dat] *******************************************
[0;36mskipping: [db-node-01][0m

TASK [galera : Bootstrap New Cluster] ******************************************
[0;36mskipping: [db-node-01][0m

TASK [galera : CASE 1/Join: Start MariaDB (Joining)] ***************************
[0;36mskipping: [db-node-01][0m

TASK [galera : LVS-DR: Loopback VIP] *******************************************
[0;32mok: [db-node-01][0m

TASK [galera : HCIP: Interface dummy0 Setup] ***********************************
[0;32mok: [db-node-01][0m

TASK [galera : HCIP: Deploy Keepalived Files] **********************************
[0;32mok: [db-node-01] => (item={'src': 'galera_hcip_manager.sh.j2', 'dest': '/usr/local/sbin/galera_healthcheck.sh', 'mode': '0755'})[0m
[0;35m[DEPRECATION WARNING]: INJECT_FACTS_AS_VARS default to `True` is deprecated, top-level facts will not be auto injected after the change. This feature will be removed from ansible-core version 2.24.[0m
[0;35m[0m
[0;32mok: [db-node-01] => (item={'src': 'db_keepalived.conf.j2', 'dest': '/etc/keepalived/keepalived.conf', 'mode': '0644'})[0m

TASK [galera : HCIP: Ensure Keepalived service] ********************************
[0;32mok: [db-node-01][0m

TASK [galera : WAIT: Wait for Synced state] ************************************
[0;36mskipping: [db-node-01][0m

TASK [galera : USERS: Setup Database Access] ***********************************
[0;35m[DEPRECATION WARNING]: Importing 'to_native' from 'ansible.module_utils._text' is deprecated. This feature will be removed from ansible-core version 2.24. Use ansible.module_utils.common.text.converters instead.[0m
[0;32mok: [db-node-01] => (item={'name': 'sst_user', 'host': '%'})[0m
[0;32mok: [db-node-01] => (item={'name': 'root', 'host': '%'})[0m
[0;32mok: [db-node-01] => (item={'name': 'root', 'host': 'localhost'})[0m

TASK [galera : Allow Root Access from Remote Network] **************************
[0;32mok: [db-node-01] => (item=%)[0m
[0;32mok: [db-node-01] => (item=localhost)[0m

PLAY [Phase 3 - Build Galera Cluster] ******************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [db-node-02][0m

TASK [galera : DISCOVERY: Audit all nodes (Pre-Flight)] ************************
[0;32mok: [db-node-02 -> db-node-01(192.168.64.2)] => (item=db-node-01)[0m
[0;32mok: [db-node-02] => (item=db-node-02)[0m
[0;32mok: [db-node-02 -> db-node-03(192.168.64.4)] => (item=db-node-03)[0m

TASK [galera : DISCOVERY: Check if MariaDB is installed] ***********************
[0;32mok: [db-node-02][0m

TASK [galera : DISCOVERY: Check local service status] **************************
[0;32mok: [db-node-02][0m

TASK [galera : DISCOVERY: Check local Galera state] ****************************
[0;32mok: [db-node-02][0m

TASK [galera : DISCOVERY: Get Sequence Number (GTID) from grastate] ************
[0;32mok: [db-node-02][0m

TASK [galera : DISCOVERY: Check HCIP ownership] ********************************
[0;32mok: [db-node-02][0m

TASK [galera : LOGIC: Set Local Discovery Facts] *******************************
[0;32mok: [db-node-02][0m

TASK [galera : LOGIC: Determine best Bootstrap node (Last Man Standing)] *******
[0;32mok: [db-node-02][0m

TASK [galera : INSTALL: Base MariaDB & Dependencies] ***************************
[0;36mskipping: [db-node-02][0m

TASK [galera : CASE 4: Resolve Split-Brain via HCIP Master] ********************
[0;36mskipping: [db-node-02][0m

TASK [galera : Prepare grastate.dat] *******************************************
[0;36mskipping: [db-node-02][0m

TASK [galera : Bootstrap New Cluster] ******************************************
[0;36mskipping: [db-node-02][0m

TASK [galera : CASE 1/Join: Start MariaDB (Joining)] ***************************
[0;36mskipping: [db-node-02][0m

TASK [galera : LVS-DR: Loopback VIP] *******************************************
[0;32mok: [db-node-02][0m

TASK [galera : HCIP: Interface dummy0 Setup] ***********************************
[0;32mok: [db-node-02][0m

TASK [galera : HCIP: Deploy Keepalived Files] **********************************
[0;32mok: [db-node-02] => (item={'src': 'galera_hcip_manager.sh.j2', 'dest': '/usr/local/sbin/galera_healthcheck.sh', 'mode': '0755'})[0m
[0;32mok: [db-node-02] => (item={'src': 'db_keepalived.conf.j2', 'dest': '/etc/keepalived/keepalived.conf', 'mode': '0644'})[0m

TASK [galera : HCIP: Ensure Keepalived service] ********************************
[0;32mok: [db-node-02][0m

TASK [galera : WAIT: Wait for Synced state] ************************************
[0;36mskipping: [db-node-02][0m

TASK [galera : USERS: Setup Database Access] ***********************************
[0;32mok: [db-node-02] => (item={'name': 'sst_user', 'host': '%'})[0m
[0;32mok: [db-node-02] => (item={'name': 'root', 'host': '%'})[0m
[0;32mok: [db-node-02] => (item={'name': 'root', 'host': 'localhost'})[0m

TASK [galera : Allow Root Access from Remote Network] **************************
[0;32mok: [db-node-02] => (item=%)[0m
[0;32mok: [db-node-02] => (item=localhost)[0m

PLAY [Phase 3 - Build Galera Cluster] ******************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [db-node-03][0m

TASK [galera : DISCOVERY: Audit all nodes (Pre-Flight)] ************************
[0;32mok: [db-node-03 -> db-node-01(192.168.64.2)] => (item=db-node-01)[0m
[0;32mok: [db-node-03 -> db-node-02(192.168.64.3)] => (item=db-node-02)[0m
[0;32mok: [db-node-03] => (item=db-node-03)[0m

TASK [galera : DISCOVERY: Check if MariaDB is installed] ***********************
[0;32mok: [db-node-03][0m

TASK [galera : DISCOVERY: Check local service status] **************************
[0;32mok: [db-node-03][0m

TASK [galera : DISCOVERY: Check local Galera state] ****************************
[0;32mok: [db-node-03][0m

TASK [galera : DISCOVERY: Get Sequence Number (GTID) from grastate] ************
[0;32mok: [db-node-03][0m

TASK [galera : DISCOVERY: Check HCIP ownership] ********************************
[0;32mok: [db-node-03][0m

TASK [galera : LOGIC: Set Local Discovery Facts] *******************************
[0;32mok: [db-node-03][0m

TASK [galera : LOGIC: Determine best Bootstrap node (Last Man Standing)] *******
[0;32mok: [db-node-03][0m

TASK [galera : INSTALL: Base MariaDB & Dependencies] ***************************
[0;36mskipping: [db-node-03][0m

TASK [galera : CASE 4: Resolve Split-Brain via HCIP Master] ********************
[0;36mskipping: [db-node-03][0m

TASK [galera : Prepare grastate.dat] *******************************************
[0;36mskipping: [db-node-03][0m

TASK [galera : Bootstrap New Cluster] ******************************************
[0;36mskipping: [db-node-03][0m

TASK [galera : CASE 1/Join: Start MariaDB (Joining)] ***************************
[0;36mskipping: [db-node-03][0m

TASK [galera : LVS-DR: Loopback VIP] *******************************************
[0;36mskipping: [db-node-03][0m

TASK [galera : HCIP: Interface dummy0 Setup] ***********************************
[0;36mskipping: [db-node-03][0m

TASK [galera : HCIP: Deploy Keepalived Files] **********************************
[0;36mskipping: [db-node-03] => (item={'src': 'galera_hcip_manager.sh.j2', 'dest': '/usr/local/sbin/galera_healthcheck.sh', 'mode': '0755'}) [0m
[0;36mskipping: [db-node-03] => (item={'src': 'db_keepalived.conf.j2', 'dest': '/etc/keepalived/keepalived.conf', 'mode': '0644'}) [0m
[0;36mskipping: [db-node-03][0m

TASK [galera : HCIP: Ensure Keepalived service] ********************************
[0;36mskipping: [db-node-03][0m

TASK [galera : WAIT: Wait for Synced state] ************************************
[0;36mskipping: [db-node-03][0m

TASK [galera : USERS: Setup Database Access] ***********************************
[0;32mok: [db-node-03] => (item={'name': 'sst_user', 'host': '%'})[0m
[0;32mok: [db-node-03] => (item={'name': 'root', 'host': '%'})[0m
[0;32mok: [db-node-03] => (item={'name': 'root', 'host': 'localhost'})[0m

TASK [galera : Allow Root Access from Remote Network] **************************
[0;32mok: [db-node-03] => (item=%)[0m
[0;32mok: [db-node-03] => (item=localhost)[0m

PLAY [Setup LVS Load Balancers] ************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [lvs-node-2][0m
[0;32mok: [lvs-node-1][0m

TASK [lvs : Install LVS and Keepalived dependencies] ***************************
[0;32mok: [lvs-node-1][0m
[0;32mok: [lvs-node-2][0m

TASK [lvs : Enable IPv4 forwarding] ********************************************
[0;32mok: [lvs-node-2][0m
[0;32mok: [lvs-node-1][0m

TASK [lvs : Ensure .ssh directory exists for root] *****************************
[0;32mok: [lvs-node-1][0m
[0;32mok: [lvs-node-2][0m

TASK [lvs : Deploy SSH Private Key for LVS Health Checks] **********************
[0;32mok: [lvs-node-1][0m
[0;32mok: [lvs-node-2][0m

TASK [lvs : Deploy LVS Health Check script] ************************************
[0;32mok: [lvs-node-1][0m
[0;32mok: [lvs-node-2][0m

TASK [lvs : Deploy Keepalived configuration from template] *********************
[0;35m[0m
[0;32mok: [lvs-node-1][0m
[0;32mok: [lvs-node-2][0m

TASK [lvs : Start and Enable Keepalived] ***************************************
[0;32mok: [lvs-node-2][0m
[0;32mok: [lvs-node-1][0m

PLAY [Configure Async Replica] *************************************************

TASK [Gathering Facts] *********************************************************
[0;32mok: [async-node][0m

TASK [async_replica : PRE-FLIGHT: Ensure Python MySQL dependencies are present] ***
[0;32mok: [async-node][0m

TASK [async_replica : REPLICA: Check current Replication Status] ***************
[0;32mok: [async-node][0m

TASK [async_replica : REPLICA: Check if db-node-03 is accessible and healthy] ***
[0;32mok: [async-node -> db-node-03(192.168.64.4)][0m

TASK [async_replica : LOGIC: Determine if replication needs reconfiguration] ***
[0;32mok: [async-node][0m

TASK [async_replica : Ensure MariaDB Server is installed on Async Node] ********
[0;32mok: [async-node][0m

TASK [async_replica : Ensure Replication User exists on db-node-03] ************
[0;31m[ERROR]: Task failed: Finalization of task args for 'community.mysql.mysql_user' failed: Error while resolving value for 'name': 'replication_user' is undefined[0m
[0;31m[0m
[0;31mTask failed.[0m
[0;31mOrigin: /home/ubuntu/harbour-master/backend/ansible/roles/async_replica/tasks/main.yml:54:3[0m
[0;31m[0m
[0;31m52   become: yes[0m
[0;31m53[0m
[0;31m54 - name: "Ensure Replication User exists on db-node-03"[0m
[0;31m     ^ column 3[0m
[0;31m[0m
[0;31m<<< caused by >>>[0m
[0;31m[0m
[0;31mFinalization of task args for 'community.mysql.mysql_user' failed.[0m
[0;31mOrigin: /home/ubuntu/harbour-master/backend/ansible/roles/async_replica/tasks/main.yml:55:3[0m
[0;31m[0m
[0;31m53[0m
[0;31m54 - name: "Ensure Replication User exists on db-node-03"[0m
[0;31m55   community.mysql.mysql_user:[0m
[0;31m     ^ column 3[0m
[0;31m[0m
[0;31m<<< caused by >>>[0m
[0;31m[0m
[0;31mError while resolving value for 'name': 'replication_user' is undefined[0m
[0;31mOrigin: /home/ubuntu/harbour-master/backend/ansible/roles/async_replica/tasks/main.yml:56:11[0m
[0;31m[0m
[0;31m54 - name: "Ensure Replication User exists on db-node-03"[0m
[0;31m55   community.mysql.mysql_user:[0m
[0;31m56     name: "{{ replication_user }}"[0m
[0;31m             ^ column 11[0m
[0;31m[0m
[0;31mfatal: [async-node -> db-node-03]: FAILED! => {"changed": false, "msg": "Task failed: Finalization of task args for 'community.mysql.mysql_user' failed: Error while resolving value for 'name': 'replication_user' is undefined"}[0m

PLAY RECAP *********************************************************************
[0;31masync-node[0m                 : [0;32mok=16  [0m [0;33mchanged=1   [0m unreachable=0    [0;31mfailed=1   [0m [0;36mskipped=2   [0m rescued=0    ignored=0   
[0;33mdb-node-01[0m                 : [0;32mok=25  [0m [0;33mchanged=1   [0m unreachable=0    failed=0    [0;36mskipped=8   [0m rescued=0    ignored=0   
[0;33mdb-node-02[0m                 : [0;32mok=25  [0m [0;33mchanged=1   [0m unreachable=0    failed=0    [0;36mskipped=8   [0m rescued=0    ignored=0   
[0;33mdb-node-03[0m                 : [0;32mok=21  [0m [0;33mchanged=1   [0m unreachable=0    failed=0    [0;36mskipped=12  [0m rescued=0    ignored=0   
[0;32mlocalhost[0m                  : [0;32mok=2   [0m changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[0;33mlvs-node-1[0m                 : [0;32mok=11  [0m [0;33mchanged=1   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[0;33mlvs-node-2[0m                 : [0;32mok=11  [0m [0;33mchanged=1   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
[0;33mmonitor-node[0m               : [0;32mok=3   [0m [0;33mchanged=1   [0m unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
